<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steal the Babies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Share+Tech+Mono&family=Creepster&family=Orbitron:wght@400;900&display=swap');
        
        body {
            font-family: 'Fredoka', sans-serif;
            background: #0f172a;
            color: white;
            overflow-x: hidden;
            user-select: none;
            transition: all 0.5s ease;
        }

        /* THEMES */
        body.theme-whoa {
            background: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff);
            background-size: 400% 400%;
            animation: rainbowBG 5s ease infinite, screenShake 5s infinite;
        }
        
        body.theme-matrix {
            background: #000;
            color: #00ff41;
            font-family: 'Share Tech Mono', monospace;
        }

        body.theme-hell {
            background: #2e0000;
            color: #ff4d4d;
            font-family: 'Creepster', system-ui;
            animation: pulseBg 2s infinite;
        }

        body.theme-galactic {
            background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
            font-family: 'Orbitron', sans-serif;
        }

        @keyframes pulseBg {
            0%, 100% { background-color: #1a0000; }
            50% { background-color: #440000; }
        }

        @keyframes rainbowBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes screenShake {
            0%, 90%, 100% { transform: translate(0, 0) rotate(0); }
            92% { transform: translate(5px, 5px) rotate(1deg); }
            94% { transform: translate(-5px, -5px) rotate(-1deg); }
            96% { transform: translate(5px, -5px) rotate(1deg); }
            98% { transform: translate(-5px, 5px) rotate(-1deg); }
        }

        .rarity-dirt-cheap { color: #78350f; }
        .rarity-common { color: #9ca3af; }
        .rarity-uncommon { color: #4ade80; }
        .rarity-epic { color: #a855f7; }
        .rarity-legendary { color: #facc15; }
        .rarity-secret { color: #f43f5e; font-weight: bold; text-shadow: 0 0 10px rgba(244, 63, 94, 0.5); }
        .rarity-holy { color: #00f2ff; font-weight: 900; text-shadow: 0 0 15px #00f2ff; animation: pulse 1s infinite alternate; }
        .rarity-glitch { color: #fff; text-shadow: 2px 2px #ff0000, -2px -2px #0000ff; animation: glitch 0.2s infinite; }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        @keyframes pulse {
            from { opacity: 0.7; transform: scale(1); }
            to { opacity: 1; transform: scale(1.05); }
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 1rem;
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .withered {
            filter: grayscale(0.8) brightness(0.4) contrast(1.4) sepia(0.2);
        }

        .recycle-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }
        .inventory-item:hover .recycle-overlay {
            opacity: 1;
        }

        .equipped-border {
            border-color: #facc15 !important;
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.4);
        }

        .count-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: white;
            color: black;
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 900;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 20;
        }

        /* Console styling */
        #console-panel {
            font-family: 'Share Tech Mono', monospace;
            background: rgba(0, 0, 0, 0.95);
            color: #00ff41;
            border-top: 2px solid #333;
        }

        #console-input {
            background: transparent;
            border: none;
            outline: none;
            color: white;
            width: 100%;
        }

        .luck-boost-active {
            animation: luckGlow 1s infinite alternate;
        }

        @keyframes luckGlow {
            from { box-shadow: 0 0 5px #facc15; }
            to { box-shadow: 0 0 20px #facc15; }
        }
    </style>
</head>
<body class="p-4 md:p-8" id="game-body">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 bg-slate-800 p-6 rounded-2xl shadow-xl border-b-4 border-slate-700">
            <div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">Steal the Babies</h1>
                <div class="flex flex-wrap gap-2 mt-2">
                    <button onclick="setTheme('normal')" id="theme-normal" class="text-[10px] px-3 py-1 rounded-full bg-slate-600 border-2 border-white">Normal</button>
                    <button onclick="setTheme('whoa')" id="theme-whoa" class="text-[10px] px-3 py-1 rounded-full bg-slate-700 border-2 border-transparent">Whoa</button>
                    <button onclick="setTheme('matrix')" id="theme-matrix" class="text-[10px] px-3 py-1 rounded-full bg-slate-800 border-2 border-transparent">Matrix</button>
                    <button onclick="setTheme('hell')" id="theme-hell" class="text-[10px] px-3 py-1 rounded-full bg-red-900 border-2 border-transparent">Hell</button>
                    <button onclick="setTheme('galactic')" id="theme-galactic" class="text-[10px] px-3 py-1 rounded-full bg-indigo-900 border-2 border-transparent">Galactic</button>
                </div>
            </div>
            <div class="text-right mt-4 md:mt-0">
                <div class="text-3xl font-bold text-yellow-400" id="coin-display">üí∞ 0</div>
                <div class="text-xs text-slate-400" id="roll-count">Rolls: 0</div>
                <button onclick="resetGame()" class="text-[10px] text-red-400 hover:underline mt-2">Wipe All Data</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 pb-10">
            <div class="space-y-6">
                <!-- Money Clicker -->
                <div class="bg-slate-800 p-6 rounded-2xl shadow-lg text-center border-2 border-slate-700 relative overflow-hidden">
                    <h2 class="text-xl mb-4 font-bold">Earn Cash</h2>
                    <button id="click-btn" class="bg-blue-600 hover:bg-blue-500 w-32 h-32 rounded-full mx-auto flex items-center justify-center text-4xl shadow-2xl transition-all border-b-8 border-blue-800 active:border-b-0 active:translate-y-2 relative z-10">
                        üí∏
                    </button>
                </div>

                <!-- Roll Actions -->
                <div class="bg-slate-800 p-6 rounded-2xl shadow-lg text-center border-2 border-slate-700">
                    <h2 class="text-xl mb-4 font-bold">Shop</h2>
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <button id="btn-jacket" onclick="toggleAddon('jacket')" class="text-[10px] py-2 rounded border-2 border-slate-600 bg-slate-700 transition-all">
                            üß• Jacket<br><span class="text-green-400">2x Luck</span>
                        </button>
                        <button id="btn-shorts" onclick="toggleAddon('shorts')" class="text-[10px] py-2 rounded border-2 border-slate-600 bg-slate-700 transition-all">
                            ü©≥ Shorts<br><span class="text-red-400">0.5x Luck</span>
                        </button>
                    </div>
                    <button id="roll-btn" class="bg-purple-600 hover:bg-purple-500 w-full py-4 rounded-xl font-bold text-lg shadow-lg border-b-4 border-purple-800 transition-all active:border-b-0 active:translate-y-1">
                        ROLL (10 üí∞)
                    </button>
                </div>

                <!-- Reward Button -->
                <div class="bg-slate-800 p-6 rounded-2xl shadow-lg text-center border-2 border-slate-700">
                    <h2 class="text-xl mb-2 font-bold">Boosts</h2>
                    <p class="text-[10px] text-slate-400 mb-4 italic">Watch a "Fake Ad" for Luck!</p>
                    <button id="ad-btn" onclick="startAd()" class="bg-yellow-600 hover:bg-yellow-500 w-full py-3 rounded-xl font-bold text-sm shadow-lg border-b-4 border-yellow-800 transition-all flex flex-col items-center justify-center">
                        <span>üì∫ REWARD BOOST</span>
                        <span class="text-[9px] font-normal opacity-70">5x Luck for 1m</span>
                    </button>
                    <div id="ad-timer-container" class="hidden mt-4">
                        <div class="h-2 w-full bg-slate-700 rounded-full overflow-hidden">
                            <div id="ad-progress" class="h-full bg-yellow-400 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p id="ad-status" class="text-xs mt-2 font-mono text-yellow-400">Watching Ad... 20s</p>
                    </div>
                    <div id="boost-active-timer" class="hidden mt-4 bg-yellow-400/20 p-2 rounded-lg border border-yellow-400/50">
                        <p class="text-xs font-bold text-yellow-400 uppercase tracking-tighter">üî• 5X LUCK ACTIVE üî•</p>
                        <p id="boost-timer-display" class="text-sm font-mono text-yellow-200">00:60</p>
                    </div>
                </div>
            </div>

            <div class="md:col-span-2 flex flex-col">
                <!-- Result Screen -->
                <div id="display-area" class="bg-slate-900/50 p-8 rounded-3xl border-4 border-dashed border-slate-700 flex flex-col items-center justify-center min-h-[420px] relative overflow-hidden">
                    <div id="result-container" class="hidden flex flex-col items-center text-center">
                        <div id="result-model" class="w-48 h-48 mb-6 floating"></div>
                        <h3 id="result-rarity" class="uppercase tracking-widest text-sm font-bold mb-1">COMMON</h3>
                        <h2 id="result-name" class="text-4xl font-bold mb-4">Character Name</h2>
                        <div id="new-tag" class="hidden bg-red-500 text-white px-4 py-1 rounded-full text-xs font-bold animate-bounce shadow-lg">NEW STOLEN BABY!</div>
                    </div>
                    <div id="idle-msg" class="text-slate-500 text-center">
                        <p class="text-6xl mb-4">üë∂</p>
                        <p class="text-xl">Roll to kidnap some babies!</p>
                    </div>
                </div>

                <!-- Achievements -->
                <div class="mt-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">üèÜ Milestones</h2>
                    <div id="achievements-container" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
                </div>

                <!-- Inventory -->
                <div class="mt-8">
                    <h2 class="text-2xl font-bold mb-4 flex justify-between items-center">
                        üìÇ Inventory 
                        <span id="collection-stats" class="text-sm font-normal text-slate-400">0 / 0</span>
                    </h2>
                    <div id="inventory" class="inventory-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Console Terminal -->
    <div id="console-panel" class="fixed bottom-0 left-0 right-0 h-40 transform translate-y-full transition-transform z-[1000] p-4 flex flex-col">
        <div class="flex justify-between items-center text-xs mb-2 opacity-50 border-b border-green-900/50 pb-1">
            <span>LS_BABY_TERMINAL v1.0.4 - Press ~ to Close</span>
            <span id="cheats-status">CHEATS: OFF</span>
        </div>
        <div id="console-output" class="flex-grow overflow-y-auto text-[10px] mb-2 space-y-1">
            <p>> Welcome to Baby Console. Enter "help" for list of commands.</p>
        </div>
        <div class="flex items-center gap-2 border-t border-green-900/50 pt-2">
            <span class="text-green-400 font-bold">></span>
            <input type="text" id="console-input" placeholder="ls_command..." autocomplete="off">
        </div>
    </div>

    <!-- Modals -->
    <div id="blessing-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
        <div class="bg-yellow-500 text-black p-8 rounded-3xl text-center max-w-sm shadow-[0_0_80px_#facc15] animate-bounce">
            <h2 class="text-5xl font-black mb-4 italic">LUIS!</h2>
            <p class="mb-6 font-bold text-lg uppercase">Next roll is 100% Rare!</p>
            <button onclick="closeBlessing()" class="bg-black text-white px-10 py-4 rounded-full font-bold">THANK YOU LUIS</button>
        </div>
    </div>

    <div id="achievement-toast" class="fixed top-4 left-1/2 -translate-x-1/2 bg-yellow-500 text-black px-6 py-4 rounded-2xl shadow-2xl opacity-0 pointer-events-none z-[200] transition-all transform -translate-y-10 border-4 border-white">
        <div class="flex items-center gap-4">
            <span class="text-3xl">üéâ</span>
            <div>
                <p id="achievement-toast-name" class="font-bold text-xl leading-tight"></p>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-20 left-1/2 -translate-x-1/2 bg-red-600 text-white font-bold px-8 py-3 rounded-full shadow-2xl opacity-0 pointer-events-none z-50 transition-all">
        Not enough coins!
    </div>

    <script>
        const CHARACTERS = [
            { id: 'niche-baby', name: 'Niche Baby', rarity: 'glitch', chance: 0.0001, hidden: true, value: 1000 },
            { id: 'ascended-baby', name: 'The Ascended Baby', rarity: 'holy', chance: 0.1, value: 500 },
            { id: 'baby-luis', name: 'Baby Luis', rarity: 'secret', chance: 0.9, value: 200 },
            { id: 'withered-luis', name: 'Withered Luis', rarity: 'legendary', chance: 1, value: 150 },
            { id: 'withered-eli', name: 'Withered Eli', rarity: 'legendary', chance: 1.2, value: 150 },
            { id: 'withered-aron', name: 'Withered Aron', rarity: 'legendary', chance: 1.3, value: 150 },
            { id: 'danny-ca-r6', name: 'Danny from CA R6', rarity: 'legendary', chance: 1.5, value: 150 },
            { id: 'golden-luis', name: 'Golden Luis', rarity: 'legendary', chance: 1.5, value: 150 },
            { id: 'luis', name: 'Luis', rarity: 'legendary', chance: 1, value: 150 },
            { id: 'baby-danny', name: 'Baby Danny', rarity: 'epic', chance: 2, value: 80 },
            { id: 'baby-alan', name: 'Baby Alan', rarity: 'epic', chance: 2, value: 80 },
            { id: 'baby-eli', name: 'Baby Eli', rarity: 'epic', chance: 2, value: 80 },
            { id: 'baby-iker', name: 'Baby Iker', rarity: 'epic', chance: 2.2, value: 80 },
            { id: 'alan', name: 'Alan', rarity: 'epic', chance: 2, value: 80 },
            { id: 'baby-rami', name: 'Baby Rami', rarity: 'epic', chance: 2, value: 80 },
            { id: 'withered-eddie', name: 'Withered Eddie', rarity: 'epic', chance: 3, value: 60 },
            { id: 'withered-rami', name: 'Withered Rami', rarity: 'epic', chance: 3, value: 60 },
            { id: 'withered-alan', name: 'Withered Alan', rarity: 'epic', chance: 3, value: 60 },
            { id: 'watermelon-kam', name: 'Watermelon Kam', rarity: 'uncommon', chance: 4, value: 30 },
            { id: 'booty-baby-kam', name: 'Booty Baby Kam', rarity: 'uncommon', chance: 4, value: 30 },
            { id: 'danny-ca', name: 'Danny from CA', rarity: 'uncommon', chance: 4, value: 30 },
            { id: 'eli', name: 'Eli', rarity: 'uncommon', chance: 4, value: 30 },
            { id: 'kam', name: 'Kam', rarity: 'uncommon', chance: 4, value: 30 },
            { id: 'ghost-luis', name: 'Ghost Luis', rarity: 'uncommon', chance: 4, value: 30 },
            { id: 'baby-eddie', name: 'Baby Eddie', rarity: 'uncommon', chance: 5, value: 20 },
            { id: 'baby-aron', name: 'Baby Aron', rarity: 'uncommon', chance: 5, value: 20 },
            { id: 'rami', name: 'Rami', rarity: 'common', chance: 10, value: 10 },
            { id: 'eddie', name: 'Eddie', rarity: 'common', chance: 10, value: 10 },
            { id: 'bit-luis', name: '8-Bit Luis', rarity: 'common', chance: 10, value: 10 },
            { id: 'aron', name: 'Aron', rarity: 'dirt-cheap', chance: 10, value: 5 },
            { id: 'iker', name: 'Iker', rarity: 'dirt-cheap', chance: 10, value: 5 },
            { id: 'adrian', name: 'Adrian', rarity: 'dirt-cheap', chance: 15, value: 5 },
            { id: 'mystery-box', name: 'Empty Box', rarity: 'dirt-cheap', chance: 20, value: 2 }
        ];

        const ACHIEVEMENTS = [
            { id: 'collector', name: 'Collector', desc: 'Own every single gacha at once.' },
            { id: 'holy', name: 'Holy', desc: "Receive Luis's Blessing." },
            { id: 'why-just-them', name: 'Why just them?', desc: 'Own all Baby variants.' },
            { id: 'fnaf2-mentioned', name: 'Fnaf2 mentioned', desc: 'Own all Withered variants.' }
        ];

        let state = {
            coins: 0,
            rolls: 0,
            collection: {}, 
            unlockedAchievements: [],
            equippedAddons: { jacket: false, shorts: false },
            currentTheme: 'normal'
        };

        let isBlessed = false;
        let isConsoleOpen = false;
        let cheatsEnabled = false;
        let cheatLuckMultiplier = 1;
        
        let isAdRunning = false;
        let adLuckActive = false;
        let adLuckTimer = null;

        function save() {
            localStorage.setItem('stealTheBabies_COUNT_v3', JSON.stringify(state));
        }

        function load() {
            const data = localStorage.getItem('stealTheBabies_COUNT_v3');
            if (data) state = { ...state, ...JSON.parse(data) };
            setTheme(state.currentTheme);
            updateUI();
        }

        function resetGame() {
            if (confirm("DELETE ALL DATA?")) {
                localStorage.removeItem('stealTheBabies_COUNT_v3');
                location.reload();
            }
        }

        function setTheme(t) {
            state.currentTheme = t;
            document.getElementById('game-body').className = `p-4 md:p-8 theme-${t}`;
            ['normal', 'whoa', 'matrix', 'hell', 'galactic'].forEach(name => {
                const btn = document.getElementById(`theme-${name}`);
                if (btn) btn.style.borderColor = (t === name) ? 'white' : 'transparent';
            });
            save();
        }

        function toggleAddon(type) {
            state.equippedAddons[type] = !state.equippedAddons[type];
            updateUI();
            save();
        }

        function startAd() {
            if (isAdRunning || adLuckActive) return;
            isAdRunning = true;
            const btn = document.getElementById('ad-btn');
            const container = document.getElementById('ad-timer-container');
            const progress = document.getElementById('ad-progress');
            const status = document.getElementById('ad-status');

            btn.classList.add('opacity-50', 'pointer-events-none');
            container.classList.remove('hidden');
            
            let timeLeft = 20;
            progress.style.width = "0%";

            const interval = setInterval(() => {
                timeLeft--;
                status.innerText = `Watching Ad... ${timeLeft}s`;
                progress.style.width = `${((20 - timeLeft) / 20) * 100}%`;

                if (timeLeft <= 0) {
                    clearInterval(interval);
                    isAdRunning = false;
                    container.classList.add('hidden');
                    activateLuckBoost();
                }
            }, 1000);
        }

        function activateLuckBoost() {
            adLuckActive = true;
            document.getElementById('boost-active-timer').classList.remove('hidden');
            document.getElementById('roll-btn').classList.add('luck-boost-active');
            
            let timeLeft = 60;
            const display = document.getElementById('boost-timer-display');

            adLuckTimer = setInterval(() => {
                timeLeft--;
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                display.innerText = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(adLuckTimer);
                    adLuckActive = false;
                    document.getElementById('boost-active-timer').classList.add('hidden');
                    document.getElementById('roll-btn').classList.remove('luck-boost-active');
                    document.getElementById('ad-btn').classList.remove('opacity-50', 'pointer-events-none');
                }
            }, 1000);
        }

        function triggerRecycle(id) {
            const char = CHARACTERS.find(c => c.id === id);
            const currentCount = state.collection[id] || 0;
            if (currentCount <= 0) return;
            
            if (confirm(`Recycle 1x ${char.name} for ${char.value} coins?`)) {
                state.coins += char.value;
                state.collection[id]--;
                if (state.collection[id] <= 0) delete state.collection[id];
                updateUI();
                save();
            }
        }

        function unlockAchievement(id) {
            if (state.unlockedAchievements.includes(id)) return;
            state.unlockedAchievements.push(id);
            const ach = ACHIEVEMENTS.find(a => a.id === id);
            const toastEl = document.getElementById('achievement-toast');
            document.getElementById('achievement-toast-name').innerText = ach.name;
            toastEl.style.opacity = '1';
            toastEl.style.transform = 'translate(-50%, 0)';
            setTimeout(() => {
                toastEl.style.opacity = '0';
                toastEl.style.transform = 'translate(-50%, -10px)';
            }, 4000);
            updateUI();
            save();
        }

        function checkAchievements() {
            const ownedKeys = Object.keys(state.collection).filter(id => state.collection[id] > 0);
            if (ownedKeys.length >= CHARACTERS.length) unlockAchievement('collector');
            
            const babies = CHARACTERS.filter(c => c.id.includes('baby')).map(c => c.id);
            if (babies.every(b => state.collection[b] > 0)) unlockAchievement('why-just-them');
            
            const withered = CHARACTERS.filter(c => c.id.includes('withered')).map(c => c.id);
            if (withered.every(w => state.collection[w] > 0)) unlockAchievement('fnaf2-mentioned');
        }

        function getModelSVG(id) {
            const isBaby = id.includes('baby') || id === 'ascended-baby';
            let color = '#9ca3af';
            let extra = '';
            
            if (id.includes('rami')) color = '#5D4037';
            if (id.includes('luis')) color = '#FBC02D';
            if (id.includes('eddie')) color = '#1976D2';
            if (id.includes('kam')) color = '#43A047';
            if (id.includes('alan')) color = '#E53935';
            if (id.includes('eli')) color = '#FF4081';
            if (id.includes('adrian')) color = '#8D6E63';
            if (id.includes('aron')) color = '#607D8B';
            if (id.includes('iker')) color = '#FF8A65';
            if (id.includes('danny')) color = '#9575CD';

            const scale = isBaby ? '0.7' : '1';
            const hat = id.includes('rami') ? `<rect x="15" y="5" width="70" height="15" fill="#222" rx="2"/>` : '';
            if (id === 'niche-baby') {
                color = '#000';
                extra = '<rect width="100" height="100" fill="url(#gp)" opacity="0.6"/>';
            }
            if (id === 'mystery-box') {
                return `<svg viewBox="0 0 100 100"><rect x="20" y="20" width="60" height="60" fill="#5D4037" rx="5"/><text x="50" y="65" font-size="40" text-anchor="middle" fill="white">?</text></svg>`;
            }
            const witheredClass = id.includes('withered') ? 'class="withered"' : '';

            return `<svg viewBox="0 0 100 100" style="transform: scale(${scale})">
                <defs><pattern id="gp" width="10" height="10" patternUnits="userSpaceOnUse"><rect width="2" height="10" fill="red" x="0"/><rect width="2" height="10" fill="blue" x="8"/></pattern></defs>
                <g ${witheredClass}>
                    <circle cx="50" cy="65" r="30" fill="${color}" />
                    <circle cx="50" cy="35" r="25" fill="${color}" />
                    <circle cx="40" cy="30" r="3" fill="white" /><circle cx="60" cy="30" r="3" fill="white" />
                    <path d="M 40 45 Q 50 55 60 45" stroke="white" fill="none" stroke-width="2" />
                    ${hat} ${extra}
                </g></svg>`;
        }

        function updateUI() {
            document.getElementById('coin-display').innerText = `üí∞ ${Math.floor(state.coins)}`;
            document.getElementById('roll-count').innerText = `Rolls: ${state.rolls}`;
            
            const ownedKeys = Object.keys(state.collection).filter(id => state.collection[id] > 0);
            const totalNormal = CHARACTERS.filter(c => !c.hidden).length;
            document.getElementById('collection-stats').innerText = `${ownedKeys.length} / ${totalNormal}`;
            
            document.getElementById('btn-jacket').className = `text-[10px] py-2 rounded border-2 ${state.equippedAddons.jacket ? 'equipped-border bg-blue-900 border-blue-400' : 'bg-slate-700 border-slate-600'}`;
            document.getElementById('btn-shorts').className = `text-[10px] py-2 rounded border-2 ${state.equippedAddons.shorts ? 'equipped-border bg-red-900 border-red-400' : 'bg-slate-700 border-slate-600'}`;

            const achievementsContainer = document.getElementById('achievements-container');
            achievementsContainer.innerHTML = '';
            ACHIEVEMENTS.forEach(ach => {
                const unlocked = state.unlockedAchievements.includes(ach.id);
                achievementsContainer.innerHTML += `
                    <div class="p-3 rounded-xl border-2 flex items-center gap-3 transition-all ${unlocked ? 'border-yellow-500 bg-yellow-500/10' : 'border-slate-700 opacity-40'}">
                        <div class="text-2xl">${unlocked ? '‚≠ê' : 'üîí'}</div>
                        <div>
                            <p class="font-bold text-sm ${unlocked ? 'text-yellow-400' : 'text-slate-400'}">${ach.name}</p>
                            <p class="text-[9px] text-slate-400 leading-tight">${ach.desc}</p>
                        </div>
                    </div>`;
            });

            const inventory = document.getElementById('inventory');
            inventory.innerHTML = '';
            CHARACTERS.forEach(char => {
                const count = state.collection[char.id] || 0;
                const isOwned = count > 0;
                if (char.hidden && !isOwned) return;
                const item = document.createElement('div');
                item.className = `inventory-item relative p-2 rounded-xl border-2 flex flex-col items-center transition-all ${isOwned ? 'bg-slate-700 border-slate-500' : 'bg-slate-900 border-slate-800 opacity-30 grayscale'}`;
                item.innerHTML = `
                    ${isOwned ? `<div class="count-badge">x${count}</div>` : ''}
                    <div class="w-12 h-12">${getModelSVG(char.id)}</div>
                    <p class="text-[9px] mt-2 font-bold rarity-${char.rarity} text-center leading-tight h-6 flex items-center">${char.name}</p>
                    ${isOwned ? `<div class="recycle-overlay rounded-xl"><p class="text-[9px] text-yellow-400 mb-1 font-bold">+${char.value} üí∞</p><button class="recycle-btn bg-red-600 text-[9px] font-bold px-3 py-1 rounded hover:bg-red-500 transition-colors">RECYCLE 1</button></div>` : ''}`;
                if (isOwned) item.querySelector('.recycle-btn').addEventListener('click', (e) => { e.stopPropagation(); triggerRecycle(char.id); });
                inventory.appendChild(item);
            });
        }

        function roll() {
            if (state.coins < 10) {
                const t = document.getElementById('toast');
                t.style.opacity = '1';
                setTimeout(() => t.style.opacity = '0', 2000);
                return;
            }
            state.coins -= 10;
            state.rolls++;

            if (Math.random() < 0.0003) {
                isBlessed = true;
                unlockAchievement('holy');
                document.getElementById('blessing-modal').classList.remove('hidden');
            }

            let luck = 1;
            if (state.equippedAddons.jacket) luck *= 2;
            if (state.equippedAddons.shorts) luck *= 0.5;
            if (adLuckActive) luck *= 5; // Ad reward
            if (cheatsEnabled) luck *= cheatLuckMultiplier; // Console cheat

            let pool = CHARACTERS.map(c => {
                let w = c.chance;
                const rare = ['holy','secret','legendary','epic','glitch'].includes(c.rarity);
                if (isBlessed && !rare) w = 0; 
                else if (rare) w *= luck;
                return { ...c, weight: w };
            });

            let totalW = pool.reduce((a, b) => a + b.weight, 0);
            let rand = Math.random() * totalW;
            let currentW = 0;
            let winner = pool[pool.length-1];
            for (let c of pool) { currentW += c.weight; if (rand <= currentW) { winner = c; break; } }

            isBlessed = false;
            document.getElementById('idle-msg').classList.add('hidden');
            document.getElementById('result-container').classList.remove('hidden');
            document.getElementById('result-model').innerHTML = getModelSVG(winner.id);
            document.getElementById('result-name').innerText = winner.name;
            const resRarity = document.getElementById('result-rarity');
            resRarity.innerText = winner.rarity.replace('-',' ');
            resRarity.className = `uppercase tracking-widest text-[10px] font-black mb-1 rarity-${winner.rarity}`;
            
            const isNew = !(state.collection[winner.id] > 0);
            if (isNew) document.getElementById('new-tag').classList.remove('hidden');
            else document.getElementById('new-tag').classList.add('hidden');

            state.collection[winner.id] = (state.collection[winner.id] || 0) + 1;
            checkAchievements();
            updateUI(); 
            save();
        }

        // Console Logic
        window.addEventListener('keydown', (e) => {
            if (e.key === '`' || e.key === '~') {
                e.preventDefault();
                isConsoleOpen = !isConsoleOpen;
                const panel = document.getElementById('console-panel');
                panel.style.transform = isConsoleOpen ? 'translateY(0)' : 'translateY(100%)';
                if (isConsoleOpen) document.getElementById('console-input').focus();
            }
        });

        document.getElementById('console-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const cmd = e.target.value.trim().toLowerCase();
                processCommand(cmd);
                e.target.value = '';
            }
        });

        function processCommand(fullCmd) {
            const parts = fullCmd.split(' ');
            const cmd = parts[0];
            const arg = parts[1];
            const output = document.getElementById('console-output');
            
            const print = (txt) => {
                const p = document.createElement('p');
                p.innerText = `> ${txt}`;
                output.appendChild(p);
                output.scrollTop = output.scrollHeight;
            };

            if (cmd === 'help') {
                print("Commands: ls_cheats [1/0], ls_luck [num], ls_coins [num], clear");
                return;
            }

            if (cmd === 'clear') {
                output.innerHTML = '';
                return;
            }

            if (cmd === 'ls_cheats') {
                cheatsEnabled = (arg === '1');
                document.getElementById('cheats-status').innerText = `CHEATS: ${cheatsEnabled ? 'ON' : 'OFF'}`;
                print(`Cheats ${cheatsEnabled ? 'Enabled' : 'Disabled'}`);
                return;
            }

            if (!cheatsEnabled) {
                print("Error: Cheats are disabled. Type 'ls_cheats 1' first.");
                return;
            }

            switch(cmd) {
                case 'ls_luck':
                    cheatLuckMultiplier = parseFloat(arg) || 1;
                    print(`Cheat Luck set to ${cheatLuckMultiplier}x`);
                    break;
                case 'ls_coins':
                    const amt = parseInt(arg) || 0;
                    state.coins += amt;
                    print(`Added ${amt} coins.`);
                    updateUI();
                    save();
                    break;
                default:
                    print(`Unknown command: ${cmd}`);
            }
        }

        document.getElementById('click-btn').addEventListener('click', () => {
            state.coins++;
            updateUI();
            save();
            const p = document.createElement('div');
            p.innerText = '+1';
            p.className = 'absolute text-yellow-400 font-bold pointer-events-none z-50 text-xl';
            p.style.left = (Math.random() * 60 + 20) + '%';
            p.style.top = '40%';
            document.getElementById('click-btn').parentElement.appendChild(p);
            p.animate([{opacity: 1}, {transform: 'translateY(-120px)', opacity: 0}], 1000).onfinish = () => p.remove();
        });

        document.getElementById('roll-btn').addEventListener('click', roll);
        function closeBlessing() { document.getElementById('blessing-modal').classList.add('hidden'); }
        window.onload = load;
    </script>
</body>
</html>
